
@{
    ViewBag.Title = "Comercia Marketing - RoutesM details";
}

<!-- ############ Content START-->
<div id="content" class="flex ">
    <!-- ############ Main START-->
    <div>
        <div class="page-hero page-container " id="page-hero">
            <div class="padding d-flex">
                @*<div class="page-title">

                    <a href="@Url.Action("Dashboard", "SalesRepresentatives")" class="btn btn-info mt-3 mb-4">Back</a>
                </div>*@
                <div class="flex"></div>
                <div>
                    @*<h2 class="text-md text-highlight">Visits</h2>
                        <small class="text-muted"></small>*@
                </div>
            </div>
        </div>
        <div class="page-content page-container" id="page-content">
            <div class="padding sr">
                <div class="card">
                    <div class="card-header bg-img p-0 no-border" data-stellar-background-ratio="0.1" data-plugin="stellar">
                        <div class="bg-light r-2x no-r-b">
                            <div class="d-md-flex">
                                <div class="p-4">
                                    <div class="d-flex">
                                        <a href="#">
                                            <span class="avatar w-64">
                                                <img src="~/Content/newstyle2/images/shutterstock_251629510-3-768x537.jpg" alt=".">
                                                <i class="on"></i>
                                            </span>
                                        </a>
                                        <div class="mx-3">
                                            <h5 class="mt-2">Route: @ViewBag.routename</h5>
                                            <div class="text-fade text-sm">
                                                <span class="m-r">Date: @ViewBag.date</span>

                                            </div>
                                            <br />

                                        </div>
                                    </div>
                                </div>
                                <span class="flex"></span>
                                <div class="align-items-center d-flex p-4">
                                    <div class="toolbar">

                                        @if ((Session["tipousuario"].ToString() == "8" && Session["tiporol"].ToString() == "8") || Session["tipousuario"].ToString() == "1")
                                        {
                                            <a href="#" style="padding: 20px 12px;margin-left:0%; margin-top:2px;" class="btn  btn-success" data-toggle="modal" data-target="#createModal">Add visit<i class="mdi mdi-plus"></i></a>

                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-3">
                        <div class="d-flex">
                            <ul class="nav nav-pills">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#" data-toggle="tab" data-target="#tab_1">Visits</a>
                                </li>
                                @*<li class="nav-item">
                                    <a class="nav-link" href="#" data-toggle="tab" data-target="#tab_2">Route</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-toggle="tab" data-target="#tab_3">Location</a>
                                </li>*@

                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 col-lg-12">
                        <div class="tab-content">
                            <div class="tab-pane fade show active card" id="tab_1">
                                @if (ViewBag.visitas.Count == 0)
                                {
                                    <label>No activities to show</label>
                                    <hr />
                                }
                                else
                                {
                                    
                                    <table id="order-listing" class="table-striped">
                                        <thead>
                                            <tr>
                                                <th scope="col">ID</th>
                                                <th scope="col">Store</th>
                                                <th scope="col">Representatives</th>
                                                <th scope="col">Status</th>
                                                @if ((Session["tipousuario"].ToString() == "8" && Session["tiporol"].ToString() == "8") || Session["tipousuario"].ToString() == "1")
                                                {
                                                    <th scope="col">Actions</th>
                                                }

                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var itemVisita in ViewBag.visitas)
                                            {
                                                <tr>
                                                    <td scope="row" data-label="ID">
                                                        @itemVisita.ID_visit


                                                    </td>

                                                    <td data-label="Store">

                                                            <a class="text-black" href="@Url.Action("Visit_details", "Admin", new { id=itemVisita.ID_visit})">
                                                                <i class="mdi mdi-store icon-sm text-info"></i>@itemVisita.store<br />
                                                                <span class="text-primary">@itemVisita.address</span>
                                                            </a>
                                                        
   

                                                    </td>
                                                    <td data-label="Representatives">@itemVisita.city &nbsp;</td>

                                                    <td data-label="Status">
                                                        @switch (itemVisita.ID_visitstate)
                                                        {
                                                            case 1: //Canceled
                                                                <label class="badge badge-danger">Canceled</label>
                                                                break;
                                                            case 2: //In Progress
                                                                <label class="badge badge-success">In progress</label>
                                                                break;
                                                            case 3: //On Hold
                                                                if (itemVisita.city == "" || itemVisita.city == null)
                                                                {
                                                                    <label class="badge badge-warning">Not assigned</label>
                                                                }
                                                                else
                                                                {
                                                                    <label class="badge badge-warning">Scheduled</label>
                                                                }

                                                                break;
                                                            case 4: //Finished
                                                                <label class="badge badge-primary">Finished</label>
                                                                break;
                                                        }

                                                    </td>
        
                                                        <td data-label="Actions">
                                                            &nbsp;
                                                            <a href="#" class="btn btn-sm btn-outline-danger ml-auto" data-toggle="modal" data-target="#deleteModal" data-ID="@itemVisita.ID_visit" data-description="@itemVisita.store">
                                                                Delete

                                                            </a>
                                                        </td>
                                                    
                                                </tr>
                                            }
                                        </tbody>
                                    </table>

                                 
                                }



                            @*</div>
                            <div class="tab-pane fade" id="tab_2">

                            </div>
                            <div class="tab-pane fade" id="tab_3">

                            </div>*@
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ############ Main END-->
</div>
<!-- ############ Content END-->
<!--CRESTE USER DATA STARTS-->
<div class="modal fade" id="createModal" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("CreateVisitRouteR2", "Home", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-account"></i>Add new visit</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="ID_route" name="ID_route" value="@ViewBag.id_route" hidden />
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Store:</label>

                        <div class="form-group">
                            <select class="form-control" name="id_store" id="id_store" style="width:100%">
                                <option value="">Select a store</option>
                                @foreach (var itemStores in ViewBag.stores)
                                {
                                    <option value="@itemStores.CardCode">@itemStores.CardCode - @itemStores.CardName</option>
                                }
                            </select>
                        </div>
                        <label class="col-form-label">Date:</label>
                        <div class="form-group">
                            <input type="date" class="form-control" name="date" id="date" />
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info">Save</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                </div>
            }
        </div>
    </div>
</div>
<!--CREATE USER DATA ENDS-->
<!--DELETE DATA STARTS-->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("DeleteVisitR2", "Home", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-delete"></i> Delete Visit Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span style="font-size: 40px" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-form-label">Are you sure you want to delete this Visit?</label><br />
                        <strong><label id="descriptionD" class="col-form-label"></label></strong>
                        <input type="text" id="ID_visitD" name="ID_visitD" hidden/>

                    </div>


                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Delete</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                </div>
            }
        </div>
    </div>
</div>