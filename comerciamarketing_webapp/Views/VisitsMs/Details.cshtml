
@{
    ViewBag.Title = "Comercia Marketing - Store_stats";
}
<div class="container-fluid page-body-wrapper">
    <!-- partial -->
    <div class="main-panel">
        <div class="content-wrapper">
            <div class="container">
                <div class="row profile-page">
                    <div class="col-12">
                        <div class="d-flex justify-content-around">
                            <div class="profile-info d-flex align-items-center">

                                <div class="wrapper pl-4">
                                    <h2 class="display-3 text-warning">@ViewBag.storename</h2>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="profile-header text-white">


                                    <a href="#" class="btn btn-success" data-toggle="modal" data-target="#createModal">Add activity<i class="mdi mdi-plus"></i></a>
                                </div>
                                <div class="profile-body">
                                    <ul class="nav tab-switch" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="user-profile-info-tab" data-toggle="pill" href="#user-profile-info" role="tab" aria-controls="user-profile-info" aria-selected="true">Activities</a>
                                        </li>
                                    </ul>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="tab-content tab-body" id="profile-log-switch">
                                                <div class="tab-pane fade show active pr-3" id="user-profile-info" role="tabpanel" aria-labelledby="user-profile-info-tab">
                                                    <br />
                                                    <div class="row">
                                                        <div class="col-md-8">
                                                            <div class="wrapper mt-8">
                                                                @if (ViewBag.activities.Count == 0)
                                                                {
                                                                    <label>No activities to show</label>
                                                                    <hr />
                                                                }
                                                                else {
                                                                    foreach (var activity in ViewBag.activities)
                                                                {
                                                                    <div class="item-wrapper d-flex pb-4 border-bottom">
                                                                        <div class="status-wrapper d-flex align-items-start pr-3">
                                                                            @if (activity.isfinished == true)
                                                                            {
                                                                                <span class="bg-success rounded-circle p-1 mt-2 mx-auto"></span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span class="bg-warning rounded-circle p-1 mt-2 mx-auto"></span>
                                                                            }
                                                                        </div>
                                                                        <div class="text-wrapper">
                                                                            @if (activity.ID_activitytype ==1)
                                                                            {
                                                                            <a href="@Url.Action("Activity", "FormsM", new { id = activity.ID_activity })" class="text-black" data-toggle="tooltip" data-placement="bottom" title="Go to activity"><h6 class="d-block mb-1" > @activity.description</h6></a>
                                                                            }
                                                                            else if (activity.ID_activitytype == 2)
                                                                            {
                                                                                 <a href="@Url.Action("Activityra", "FormsM", new { id = activity.ID_activity })" class="text-black" data-toggle="tooltip" data-placement="bottom" title="Go to activity"><h6 class="d-block mb-1" > @activity.description</h6></a>
                                                                            }
                                                                            else {
                                                                                <a href="#" class="text-black" data-toggle="tooltip" data-placement="bottom" title="Go to activity"><h6 class="d-block mb-1" > @activity.description</h6></a>
                                                                            }<small class="d-block mb-2 text-black">Customer: @activity.Customer</small>
                                                                            <small class="text-gray d-block">Last update : @activity.date</small>
                                                                        </div>
                                                                        <a href="#" class="count online ml-auto" data-toggle="modal" data-target="#deleteModal" data-ID="@activity.ID_activity" data-description="@activity.description">
                                                                            <i class="close ml-auto mdi mdi-close-circle-outline" data-toggle="tooltip" data-placement="bottom" title="Delete"></i>

                                                                        </a>

                                                                    </div><br />
                                                                }
                                                                }
                                                            </div>

                                                        </div>

                                                    </div>



                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <h5 class="my-4"><i class="mdi mdi-account-circle icon-sm text-info"></i> Who follow this visit</h5>

                                            <div class="calendar-aside">
                                                @foreach (var rep in ViewBag.repslist)
                                                {
                                                <div class="list">
                                                    <div class="text-wrapper">
                                                        <small class="d-block mb-2"><strong>@rep.name</strong></small>
                                                        <small class="text-gray d-block">@rep.email</small>
                                                    </div>
                                                    @if ((Session["tipousuario"].ToString() == "8" && Session["tiporol"].ToString() == "8") | Session["tipousuario"].ToString() == "1")
                                                    {
                                                <a href="#" class="count online ml-auto" data-toggle="modal" data-target="#deleteRepModal" data-ID="@rep.ID" data-description="@rep.name - @rep.email ">
                                                    <i class="close ml-auto mdi mdi-close-circle-outline" data-toggle="tooltip" data-placement="bottom" title="Delete"></i>
                                                </a>
                                                    }
                                                    else {
                                                        <a href="javascript:void(0)" class="count online ml-auto">
                                                   
                                                </a>
                                                    }</div>
                                                }
                                            </div><h5 class="my-4"><i class="mdi mdi-format-list-bulleted icon-sm text-info"></i> To Do List</h5><div class="add-items d-flex">
                                                <input type="text" class="form-control todo-list-input" placeholder="What do you need to do?">
                                                <button class="add btn btn-primary font-weight-medium todo-list-add-btn">Add</button>
                                            </div><div class="list-wrapper">
                                                <ul class="d-flex flex-column-reverse todo-list todo-list-custom">
                                                    <li>
                                                        <div class="form-check form-check-flat">
                                                            <label class="form-check-label">
                                                                <input class="checkbox" type="checkbox">
                                                                Example
                                                            </label>
                                                        </div>
                                                        <i class="remove mdi mdi-close-circle-outline"></i>
                                                    </li>
                                                    <li class="completed">
                                                        <div class="form-check form-check-flat">
                                                            <label class="form-check-label">
                                                                <input class="checkbox" type="checkbox" checked>
                                                                Example completed
                                                            </label>
                                                        </div>
                                                        <i class="remove mdi mdi-close-circle-outline"></i>
                                                    </li>

                                                </ul>
                                            </div></div></div></div></div></div></div></div></div><!-- partial:../../partials/_footer.html -->@Html.Partial("~/Views/Shared/Footer2.cshtml")
        </div>

    </div>
    <!-- content-wrapper ends -->
    <!-- partial -->
</div>


<!--CRESTE USER DATA STARTS-->
<div class="modal fade" id="createModal" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("CreateActivity", "VisitsMs", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-file-cloud"></i> Add New activity</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="ID_visita" name="ID_visita" hidden value="@ViewBag.idvisita" />
                    <div class="col-12 grid-margin">
                        <div class="card">
                            <div class="card-body">

                                <p class="card-description">
                                    <h4 class="card-title">Activity</h4>
                                </p>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group row">
                                            <select name="ID_form" class="js-example-basic-single" style="width:100%">
                                                <option value="0">Select an activity</option>
                                                <optgroup label="Forms"></optgroup>
                                                @foreach (var form in ViewBag.activeforms)
                                                {
                                                    if (form.ID_activity == 1)
                                                    {
                                                        <option value="@form.ID_form">@form.name</option>
                                                    }
                                                }
                                                <optgroup label="Retail Audit"></optgroup>
                                                @foreach (var form in ViewBag.activeforms)
                                                {
                                                    if (form.ID_activity == 2)
                                                    {
                                                        <option value="@form.ID_form">@form.name</option>
                                                    }
                                                }
                                                <optgroup label="Sales Order">
                                                    @foreach (var form in ViewBag.activeforms)
                                                    {
                                                        if (form.ID_activity == 3)
                                                        {
                                                            <option value="@form.ID_form">@form.name</option>
                                                        }
                                                    }
                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <p class="card-description">
                                    <h4 class="card-title">Customer</h4>
                                </p>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group row">
                                            <select name="ID_customer" class="js-example-basic-single" style="width:100%">
                                                <option id="0">Select a customer</option>
                                                @foreach (var customer in ViewBag.customers)
                                                {

                                                    <option value="@customer.CardCode">@customer.CardName</option>
                                                }



                                            </select>
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info">Add</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                </div>
            }
        </div>
    </div>
</div>
<!--CREATE USER DATA ENDS-->
<!--DELETE DATA STARTS-->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("DeleteActivity", "VisitsMs", FormMethod.Post))
            {
        @Html.AntiForgeryToken()
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-delete"></i> Delete Activity Data</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
           
                <div class="form-group">
                    <label class="col-form-label">Are you sure you want to delete this activity?</label><br />
                    <strong><label id="descriptionD" class="col-form-label"></label></strong>
                    <input type="text" id="ID_activityD" name="ID_activityD" hidden />
                    <input type="text" id="ID_visitA" name="ID_visitA" value="@ViewBag.idvisita" hidden/>
                </div>

           
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-danger">Delete</button>
            <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
        </div>
            }
        </div>
    </div>
</div>

<!--DELETE DATA ENDS-->
<!--DELETE DATA STARTS-->
<div class="modal fade" id="deleteRepModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("DeleteRepfromActivity", "VisitsMs", FormMethod.Post))
            {
        @Html.AntiForgeryToken()
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-delete"></i> Remove representative from visit</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            
                <div class="form-group">
                    <label class="col-form-label">Are you sure you want to remove this representative?</label>
                    <strong><label id="descriptionUD" class="col-form-label"></label></strong>
                    <input type="text" id="ID_repUD" name="ID_repUD" hidden/>
                    <input type="text" id="ID_visitU" name="ID_visitU" value="@ViewBag.idvisita" hidden/>
                </div>

       
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-danger">Delete</button>
            <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
        </div>
            }
        </div>
    </div>
</div>
<!--DELETE DATA ENDS-->

<script>
    window.onload = function () {

        (function ($) {
            'use strict';
            $('#deleteModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);// Button that triggered the modal

                var IDAct = $(event.relatedTarget).data("id");// Extract info from data-* attributes
                var DesAct = $(event.relatedTarget).data("description");


                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                var modal = $(this);
                //modal.find('.modal-title').text('Edit data: ' + recipient)
                modal.find('.modal-body input[name="ID_activityD"]').val(IDAct);
                $("#descriptionD").text(DesAct);

            })
        })(jQuery);


        (function ($) {
            'use strict';
            $('#deleteRepModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);// Button that triggered the modal

                var IDAct = $(event.relatedTarget).data("id");// Extract info from data-* attributes
                var DesAct = $(event.relatedTarget).data("description");


                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                var modal = $(this);
                //modal.find('.modal-title').text('Edit data: ' + recipient)
                modal.find('.modal-body input[name="ID_repUD"]').val(IDAct);
                $("#descriptionUD").text(DesAct);

            })
        })(jQuery);
    }
</script>
